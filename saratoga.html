<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saratoga Interactive Handicapping Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: "Warm Neutral" - A calm, professional palette with shades of beige, tan, and brown, accented with a subtle blue for interactive elements. -->
    <!-- Application Structure Plan: The application is structured as a single-page dashboard. A persistent left-hand navigation allows users to jump to any of the 10 races. The main content area is divided into three key thematic sections: a high-level "At a Glance" summary with key bets, a detailed "Race-by-Race Analysis" section, and a "Track Bias Insights" section for contextual data. This structure was chosen to cater to different user needs: quick access to top picks, deep dives into specific races, and foundational track data. The flow is non-linear, allowing users to explore based on their priorities. -->
    <!-- Visualization & Content Choices: 
        - Race Overview: Goal: Inform. Method: Structured HTML text. Interaction: None. Justification: Clear, scannable presentation of basic race facts.
        - Pace Projection: Goal: Inform/Organize. Method: HTML card with color-coded badge. Interaction: None. Justification: Immediately conveys the critical pace scenario.
        - Speed Figure Comparison: Goal: Compare. Method: Horizontal Bar Chart (Chart.js). Interaction: Tooltips on hover to show exact figures. Justification: Provides a quick, visual comparison of the top contenders' speed figures, a key handicapping factor.
        - Value-Oriented Rankings: Goal: Organize/Inform. Method: Tabbed interface (HTML/JS). Interaction: Clicking tabs to switch between Contenders, Value Overlays, and Vulnerable Favorites. Justification: Organizes complex rankings into digestible, user-selectable categories.
        - Betting Strategy: Goal: Inform. Method: Accordion (HTML/JS). Interaction: Click to expand/collapse Thesis, Spoiler, and Wager Construction. Justification: Hides detailed text to keep the UI clean, allowing users to drill down as needed.
        - Track Bias: Goal: Compare. Method: Bar Chart (Chart.js). Interaction: Dropdown to select different distances/surfaces to update the chart. Justification: Allows for dynamic exploration of the rich track bias data provided in the report.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            background-color: #F5F5DC; /* Beige */
        }
        .nav-link {
            transition: all 0.3s;
        }
        .nav-link.active {
            background-color: #A0522D; /* Sienna */
            color: white;
            transform: scale(1.05);
        }
        .tab-link.active {
            border-bottom: 2px solid #A0522D; /* Sienna */
            color: #A0522D; /* Sienna */
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
    </style>
</head>
<body class="font-sans">

    <div class="flex flex-col lg:flex-row">
        <!-- Sidebar Navigation -->
        <nav id="sidebar" class="w-full lg:w-64 bg-[#D2B48C] text-[#654321] p-4 lg:fixed lg:h-full">
            <h1 class="text-2xl font-bold mb-4 text-center">Saratoga Races</h1>
            <p class="text-center text-sm mb-6">August 21, 2025</p>
            <ul class="space-y-2">
                <li><a href="#summary" class="nav-link block p-2 rounded-lg text-center font-semibold">At a Glance</a></li>
                <li><a href="#race1" class="nav-link block p-2 rounded-lg text-center">Race 1</a></li>
                <li><a href="#race2" class="nav-link block p-2 rounded-lg text-center">Race 2</a></li>
                <li><a href="#race3" class="nav-link block p-2 rounded-lg text-center">Race 3</a></li>
                <li><a href="#race4" class="nav-link block p-2 rounded-lg text-center">Race 4</a></li>
                <li><a href="#race5" class="nav-link block p-2 rounded-lg text-center">Race 5</a></li>
                <li><a href="#race6" class="nav-link block p-2 rounded-lg text-center">Race 6</a></li>
                <li><a href="#race7" class="nav-link block p-2 rounded-lg text-center">Race 7</a></li>
                <li><a href="#race8" class="nav-link block p-2 rounded-lg text-center">Race 8</a></li>
                <li><a href="#race9" class="nav-link block p-2 rounded-lg text-center">Race 9</a></li>
                <li><a href="#race10" class="nav-link block p-2 rounded-lg text-center">Race 10</a></li>
                <li><a href="#bias" class="nav-link block p-2 rounded-lg text-center font-semibold">Track Bias</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="w-full lg:ml-64 p-4 md:p-8">
            <section id="summary" class="mb-12">
                <h2 class="text-3xl font-bold text-[#8B4513] mb-4">Handicapper's Dashboard: At a Glance</h2>
                <p class="mb-6 text-[#654321]">This dashboard synthesizes the expert handicapping report for Saratoga's August 21, 2025 card. It's designed for quick access to key insights and value opportunities. Use the navigation to explore detailed race analyses and track bias data. The core objective is to identify market inefficiencies, not just likely winners.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="font-bold text-xl text-[#A0522D] mb-2">‚≠ê Prime Bet (A-Grade)</h3>
                        <p class="text-lg"><span class="font-semibold">Race 2:</span> #8 St. Brigid's Cross (6/1)</p>
                        <p class="text-sm mt-2 text-gray-600">A lone speed scenario after scratches gives this horse a massive tactical advantage. Excellent value.</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="font-bold text-xl text-[#A0522D] mb-2">üéØ Key Horizontal 'Single'</h3>
                        <p class="text-lg"><span class="font-semibold">Race 8:</span> #5 Catherine Wheel</p>
                        <p class="text-sm mt-2 text-gray-600">The class of the field, in top form with a great workout pattern. A reliable anchor for multi-race wagers.</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="font-bold text-xl text-[#A0522D] mb-2">üìâ Top Fades</h3>
                        <p class="text-sm"><span class="font-semibold">Race 3, #3 Kay Cup (6/5):</span> Vulnerable to a pace duel.</p>
                        <p class="text-sm"><span class="font-semibold">Race 7, #12 Gin's Beach Road (1/2):</span> Poor value at very low odds.</p>
                    </div>
                </div>
            </section>

            <!-- Race Sections -->
            <div id="race-analysis">
                <h2 class="text-3xl font-bold text-[#8B4513] mb-6">Race-by-Race Analysis</h2>
                <!-- Race data will be injected here by JavaScript -->
            </div>

            <section id="bias" class="mt-12">
                <h2 class="text-3xl font-bold text-[#8B4513] mb-4">Interactive Track Bias Analysis</h2>
                <p class="mb-6 text-[#654321]">Saratoga's track biases are a critical handicapping factor. The main dirt track heavily favors early speed, while the turf courses present different challenges. Use the dropdown below to explore the historical performance of different running styles and post positions across various distances and surfaces to see how these trends might influence today's races.</p>
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <div class="mb-4">
                        <label for="biasSelector" class="block text-sm font-medium text-gray-700">Select Track/Distance:</label>
                        <select id="biasSelector" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-[#A0522D] focus:border-[#A0522D] sm:text-sm rounded-md">
                            <!-- Options will be injected here -->
                        </select>
                    </div>
                    <div class="chart-container" style="position: relative; height:40vh; width:80vw; max-width: 600px; margin: auto;">
                        <canvas id="biasChart"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        const raceData = [
            {
                id: "race1",
                title: "Race 1: Allowance",
                overview: "7 Furlongs, Dirt, NY-Bred Fillies & Mares 3YO+, Purse: $95,000. A sprint where the main track's speed bias is a key factor.",
                pace: { type: "Pressured Duel", color: "bg-red-200 text-red-800" },
                contenders: [
                    { name: "#6 Accelerated News", speed: 111 },
                    { name: "#7 Grace And Grit", speed: 107 },
                    { name: "#3 City Blocks", speed: 98 }
                ],
                rankings: {
                    contenders: ["#6 Accelerated News", "#7 Grace And Grit", "#3 City Blocks"],
                    value: ["#1 Intentious (9/2 ML) - Hidden potential from a troubled trip likely to be overlooked."],
                    vulnerable: ["#6 Accelerated News (5/2 ML) - Strong talent but an underlay given the high risk of a taxing pace duel."]
                },
                thesis: "The primary thesis is that the likely **Pressured Duel** between early speeds will set up a pace collapse, favoring a horse with a stalking or pressing style.",
                spoiler: "The spoiler is if #6 Accelerated News demonstrates her overwhelming speed figure is no fluke and wires the field on an uncontested lead.",
                wagers: "Exacta Box: 1-3-7. Trifecta: 1,7 / 1,3,7 / 1,3,4,5,6,7. This race is unsuitable for a horizontal single."
            },
            {
                id: "race2",
                title: "Race 2: Maiden Optional Claiming",
                overview: "1 1/16 Miles, Inner Turf, 2YO Fillies, Purse: $80,000. Scratches have fundamentally altered this race.",
                pace: { type: "Lone/Uncontested", color: "bg-green-200 text-green-800" },
                contenders: [
                    { name: "#8 St. Brigid's Cross", speed: 112 },
                    { name: "#5 Mappy", speed: 109 },
                    { name: "#7 Birch Run", speed: 95 }
                ],
                rankings: {
                    contenders: ["#8 St. Brigid's Cross", "#6 Irtiqaa", "#7 Birch Run"],
                    value: ["#8 St. Brigid's Cross (6/1 ML) - Now the lone speed, offering a massive tactical advantage and value."],
                    vulnerable: ["#5 Mappy (2/1 ML) - High speed figure from a sprint is questionable at this route distance."]
                },
                thesis: "The scratch of the other primary speed horse turns this into a **Lone/Uncontested** pace scenario, giving a significant tactical advantage to #8 St. Brigid's Cross.",
                spoiler: "A talented first-time starter, like #6 Irtiqaa, could be a hidden speed horse and contest the lead.",
                wagers: "Exacta Box: 6-7-8. Trifecta: 8 / 6,7 / 1,4,5,6,7,10. Not recommended for a horizontal single."
            },
            {
                id: "race3",
                title: "Race 3: Fleet Indian Stakes",
                overview: "1 1/8 Miles, Dirt, NY-Bred 3YO Fillies, Purse: $200,000. A small but tactical stakes field.",
                pace: { type: "Pressured Duel", color: "bg-red-200 text-red-800" },
                contenders: [
                    { name: "#3 Kay Cup", speed: 102 },
                    { name: "#2 Vehemente", speed: 102 },
                    { name: "#5 Valtellina", speed: 100 }
                ],
                rankings: {
                    contenders: ["#2 Vehemente", "#3 Kay Cup", "#5 Valtellina"],
                    value: ["#5 Valtellina (5/1 ML) - Competitive form and figures at a higher price offer a significant overlay."],
                    vulnerable: ["#3 Kay Cup (6/5 ML) - Likely to be over-bet and is vulnerable to a pace duel."]
                },
                thesis: "A pressured pace will set up perfectly for a horse that can stalk and finish strongly. The bullet work and consistent class of #2 Vehemente make her the horse to beat.",
                spoiler: "If #3 Kay Cup and #4 Lottie Margaret do not duel and one gets an easy lead, they could wire the field.",
                wagers: "Exacta: 2 / 3,5. Trifecta: 2 / 3,5 / 1,3,5. #2 Vehemente is a strong candidate for a horizontal single."
            },
            {
                id: "race4",
                title: "Race 4: Allowance",
                overview: "1 1/16 Miles, Inner Turf, 3YO+, Purse: $95,000. A competitive allowance race on the turf.",
                pace: { type: "Moderately Contested", color: "bg-yellow-200 text-yellow-800" },
                contenders: [
                    { name: "#8 Ortus", speed: 117 },
                    { name: "#7 Miztertonic", speed: 114 },
                    { name: "#4 Outtawaterbury", speed: 111 }
                ],
                rankings: {
                    contenders: ["#7 Miztertonic", "#8 Ortus"],
                    value: ["#8 Ortus (6/1 ML) - Top speed figure and a recent troubled trip make him a major contender at a generous price."],
                    vulnerable: ["#7 Miztertonic (8/5 ML) - A strong contender but a vulnerable price in a competitive field."]
                },
                thesis: "#7 Miztertonic is the class of the field, is in top form, and has a bullet work. The moderate pace should set up perfectly for his stalking style.",
                spoiler: "A complete pace collapse could allow a deep closer like #9 Golden Reign to win at a huge price.",
                wagers: "Exacta: 7 / 8. Trifecta: 7 / 8 / ALL. #7 Miztertonic is a solid single for multi-race wagers."
            },
            {
                id: "race5",
                title: "Race 5: Maiden Optional Claiming",
                overview: "1 1/16 Miles, Inner Turf, 2YO Fillies, Purse: $80,000. A difficult race to handicap with many first-time starters and key scratches.",
                pace: { type: "Pace Void (Slow)", color: "bg-blue-200 text-blue-800" },
                contenders: [
                    { name: "#4 Pan Pan", speed: 98 },
                    { name: "#10 River Empress", speed: 0 },
                    { name: "#3 Fonzi Angel", speed: 0 }
                ],
                rankings: {
                    contenders: ["#4 Pan Pan", "#10 River Empress"],
                    value: ["#10 River Empress (6/1 ML) - Trainer has a high win rate with 2YOs and a proven sire.", "#4 Pan Pan (7/2 ML) - Likely to be on the lead and a deserving favorite."],
                    vulnerable: ["No vulnerable favorites in this race due to the scratches."]
                },
                thesis: "The scratch of the lone speed horse creates a **Pace Void**. This gives a huge tactical advantage to any horse that can get a clean trip on or near the lead.",
                spoiler: "A talented first-time starter could be a hidden speed horse and contest the lead with #4 Pan Pan.",
                wagers: "Exacta Box: 4-10. Trifecta: 4,10 / 4,10 / ALL. #4 Pan Pan is a logical single for multi-race wagers."
            },
            {
                id: "race6",
                title: "Race 6: Maiden Special Weight",
                overview: "6 Furlongs, Dirt, 2YO Fillies, Purse: $80,000. A large field of inexperienced fillies where pace will be key.",
                pace: { type: "Pressured Duel", color: "bg-red-200 text-red-800" },
                contenders: [
                    { name: "#7 Jetty's Home", speed: 96 },
                    { name: "#4 Sparkling Mama", speed: 93 },
                    { name: "#12 Looks To Kill", speed: 0 }
                ],
                rankings: {
                    contenders: ["#12 Looks To Kill", "#1 Donna Romano", "#7 Jetty's Home"],
                    value: ["#12 Looks To Kill (12/1 ML) - Trainer Jena Antonucci has an excellent 23% win rate with 2-year-old first-time starters, making this an elite value play."],
                    vulnerable: ["No vulnerable favorites in this race due to the scratches."]
                },
                thesis: "A fast, pressured pace will cause the front-runners to falter, giving a huge advantage to a horse with a good closing kick or a talented first-time starter.",
                spoiler: "If one horse, likely #7 Jetty's Home, is much faster than the rest and gets a lone, easy lead, she could wire the field.",
                wagers: "Exacta Box: 1,7,12. Trifecta: 12 / 1,7 / ALL. #12 Looks To Kill is an excellent longshot single."
            },
            {
                id: "race7",
                title: "Race 7: Maiden Special Weight",
                overview: "5 1/2 Furlongs, Inner Turf, 3YO+, Purse: $100,000. A turf sprint with a clear pace dynamic.",
                pace: { type: "Pressured Duel", color: "bg-red-200 text-red-800" },
                contenders: [
                    { name: "#2 Gellhorn", speed: 108 },
                    { name: "#12 Gin's Beach Road", speed: 104 },
                    { name: "#3 Shades Of Jade", speed: 95 }
                ],
                rankings: {
                    contenders: ["#2 Gellhorn", "#12 Gin's Beach Road", "#3 Shades Of Jade"],
                    value: ["#2 Gellhorn (4/1 ML) - Strong speed figures and a significant trip excuse make her a strong contender at a generous price."],
                    vulnerable: ["#12 Gin's Beach Road (1/2 ML) - A solid horse but a very poor value bet at extremely low odds."]
                },
                thesis: "A fast pace will set up for a stalker/closer. #2 Gellhorn is the class of the field and should get a perfect trip to run down the leaders.",
                spoiler: "If #12 Gin's Beach Road is allowed an easy lead, she could wire the field.",
                wagers: "Exacta: 2 / 3,12. Trifecta: 2 / 3,12 / ALL. #2 Gellhorn is an excellent single for multi-race wagers."
            },
            {
                id: "race8",
                title: "Race 8: Allowance Optional Claiming",
                overview: "1 Mile, Dirt, Fillies & Mares 3YO+, Purse: $115,000. A small but competitive field of older females.",
                pace: { type: "Moderately Contested", color: "bg-yellow-200 text-yellow-800" },
                contenders: [
                    { name: "#7 Cupid's Heart", speed: 107 },
                    { name: "#5 Catherine Wheel", speed: 105 },
                    { name: "#6 Perfect Shot", speed: 102 }
                ],
                rankings: {
                    contenders: ["#5 Catherine Wheel", "#6 Perfect Shot", "#3 Lemon Muffin"],
                    value: ["#6 Perfect Shot (5/1 ML) - Her figures are competitive with the favorite, making her a great value bet."],
                    vulnerable: ["#5 Catherine Wheel (2/1 ML) - A solid contender but a vulnerable price in a competitive field."]
                },
                thesis: "#5 Catherine Wheel is the class of the field, in top form, and has a great workout pattern. The moderate pace should set up perfectly for her stalking style.",
                spoiler: "A deep closer like #2 Goodnightngodbless could benefit from an unexpectedly fast pace and win at a huge price.",
                wagers: "Exacta Box: 3,5,6. Trifecta: 5,6 / 3,5,6 / 2,7,8. #5 Catherine Wheel is the Key Horizontal Single of the day."
            },
            {
                id: "race9",
                title: "Race 9: Albany Stakes",
                overview: "1 1/8 Miles, Dirt, NY-Bred 3YOs, Purse: $200,000. A key scratch has completely changed the complexion of this stakes race.",
                pace: { type: "Lone/Uncontested", color: "bg-green-200 text-green-800" },
                contenders: [
                    { name: "#4 Iron Dome", speed: 109 },
                    { name: "#6 Hit The Post", speed: 99 },
                    { name: "#1 King's Leap", speed: 96 }
                ],
                rankings: {
                    contenders: ["#4 Iron Dome", "#6 Hit The Post", "#1 King's Leap"],
                    value: ["#2 Just Licorice (15/1 ML) - A closer who could benefit from a slow pace and finish strong. Generous odds for his potential."],
                    vulnerable: ["#4 Iron Dome (7/5 ML) - Now the logical favorite, but his odds will likely drop, making him an underlay."]
                },
                thesis: "The scratch of the other main speed horse changes this into a **Lone/Uncontested** pace scenario, giving a massive tactical advantage to #4 Iron Dome.",
                spoiler: "Another horse could be a hidden speed and unexpectedly contest the lead with #4 Iron Dome.",
                wagers: "Exacta: 4 / 1,2,6. Trifecta: 4 / 1,2,6 / 1,2,3,6. #4 Iron Dome is a strong horizontal single."
            },
            {
                id: "race10",
                title: "Race 10: Maiden Special Weight",
                overview: "5 1/2 Furlongs, Inner Turf, NY-Bred Fillies & Mares 3YO+, Purse: $90,000. The finale is a turf sprint with a clear pace advantage for one runner.",
                pace: { type: "Lone/Uncontested", color: "bg-green-200 text-green-800" },
                contenders: [
                    { name: "#2 No Ordinary Love", speed: 117 },
                    { name: "#3 One Last Knock", speed: 115 },
                    { name: "#10 Aperitif", speed: 90 }
                ],
                rankings: {
                    contenders: ["#3 One Last Knock", "#2 No Ordinary Love"],
                    value: ["No prime value overlays in this race."],
                    vulnerable: ["#2 No Ordinary Love (5/2 ML) - A solid contender, but her low odds are an underlay in a race with unknown factors."]
                },
                thesis: "#3 One Last Knock is the lone speed and will be very difficult to beat. She and #2 No Ordinary Love are the two fastest horses in the race.",
                spoiler: "A deep closer like #10 Aperitif could benefit from an unexpectedly fast pace and win at a huge price.",
                wagers: "Exacta Box: 2,3. Trifecta: 2,3 / 2,3 / ALL. This race is a pass for a single."
            }
        ];

        const biasData = {
            "6.5f Dirt": { labels: ['Early', 'Early/Presser', 'Presser', 'Stalker'], data: [33, 0, 0, 0], posts: "Outside" },
            "7.0f Dirt": { labels: ['Early', 'Early/Presser', 'Presser', 'Stalker'], data: [25, 0, 0, 0], posts: "Outside" },
            "1 Mile Dirt": { labels: ['Early', 'Early/Presser', 'Presser', 'Stalker'], data: [0, 25, 0, 0], posts: "Outside" },
            "1 1/8m Dirt": { labels: ['Early', 'Early/Presser', 'Presser', 'Stalker'], data: [0, 24, 0, 0], posts: "Rail/Inside" },
            "Turf Sprint (Inner)": { labels: ['Early', 'Early/Presser', 'Presser', 'Stalker'], data: [0, 30, 26, 0], posts: "Mid/Out" },
            "Inner Turf Route": { labels: ['Early', 'Early/Presser', 'Presser', 'Stalker'], data: [0, 0, 11, 0], posts: "Rail/Inside" },
            "Turf Routes (Outer)": { labels: ['Early', 'Early/Presser', 'Presser', 'Stalker'], data: [0, 0, 41, 0], posts: "7 and greater" }
        };

        function createRaceCard(race) {
            return `
                <section id="${race.id}" class="mb-8 p-6 bg-white rounded-xl shadow-lg border border-gray-200">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-[#A0522D]">${race.title}</h3>
                            <p class="text-sm text-gray-600">${race.overview}</p>
                        </div>
                        <div class="text-right">
                            <span class="font-semibold text-sm">Pace Projection:</span>
                            <span class="px-3 py-1 text-xs font-semibold rounded-full ${race.pace.color}">${race.pace.type}</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-lg mb-2 text-[#654321]">Top Speed Figures</h4>
                            <div class="chart-container" style="position: relative; height:200px; max-height: 250px; width:100%;">
                                <canvas id="chart-${race.id}"></canvas>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg mb-2 text-[#654321]">Value-Oriented Rankings</h4>
                            <div class="tabs">
                                <div class="border-b border-gray-200">
                                    <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                                        <button class="tab-link active whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-tab="contenders-${race.id}">Contenders</button>
                                        <button class="tab-link whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700" data-tab="value-${race.id}">Value</button>
                                        <button class="tab-link whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700" data-tab="vulnerable-${race.id}">Vulnerable</button>
                                    </nav>
                                </div>
                                <div id="contenders-${race.id}" class="tab-content py-4">
                                    <ul class="list-disc list-inside text-sm space-y-1">${race.rankings.contenders.map(h => `<li>${h}</li>`).join('')}</ul>
                                </div>
                                <div id="value-${race.id}" class="tab-content hidden py-4">
                                    <p class="text-sm">${race.rankings.value.join('<br>')}</p>
                                </div>
                                <div id="vulnerable-${race.id}" class="tab-content hidden py-4">
                                    <p class="text-sm">${race.rankings.vulnerable.join('<br>')}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                         <div class="accordion">
                            <button class="accordion-header w-full text-left font-semibold text-lg text-[#654321] p-3 bg-gray-100 rounded-t-lg hover:bg-gray-200 transition duration-300 flex justify-between items-center">
                                <span>Betting Strategy & Thesis</span>
                                <span class="transform transition-transform duration-300">&#9662;</span>
                            </button>
                            <div class="accordion-content bg-gray-50 p-4 rounded-b-lg border border-t-0 border-gray-200">
                                <h5 class="font-bold text-md text-[#A0522D]">Race Thesis</h5>
                                <p class="text-sm mb-3">${race.thesis}</p>
                                <h5 class="font-bold text-md text-[#A0522D]">Spoiler Scenario</h5>
                                <p class="text-sm mb-3">${race.spoiler}</p>
                                <h5 class="font-bold text-md text-[#A0522D]">Wager Construction</h5>
                                <p class="text-sm">${race.wagers}</p>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const raceContainer = document.getElementById('race-analysis');
            raceData.forEach(race => {
                raceContainer.innerHTML += createRaceCard(race);
            });

            raceData.forEach(race => {
                const ctx = document.getElementById(`chart-${race.id}`).getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: race.contenders.map(c => c.name),
                        datasets: [{
                            label: 'Top Speed Figure',
                            data: race.contenders.map(c => c.speed),
                            backgroundColor: '#D2B48C',
                            borderColor: '#A0522D',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Speed Figure: ${context.raw}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                suggestedMin: 50,
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            });

            const biasSelector = document.getElementById('biasSelector');
            Object.keys(biasData).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key;
                biasSelector.appendChild(option);
            });

            let biasChart;
            function updateBiasChart(key) {
                const data = biasData[key];
                if (biasChart) {
                    biasChart.destroy();
                }
                const ctx = document.getElementById('biasChart').getContext('2d');
                biasChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: `% Winners by Style (Best Posts: ${data.posts})`,
                            data: data.data,
                            backgroundColor: ['#A0522D', '#D2B48C', '#8B4513', '#F5F5DC'],
                            borderColor: '#654321',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: `Win % by Running Style for ${key}`
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Win Percentage'
                                }
                            }
                        }
                    }
                });
            }

            biasSelector.addEventListener('change', (e) => {
                updateBiasChart(e.target.value);
            });
            updateBiasChart(Object.keys(biasData)[0]);

            // Tab functionality
            document.querySelectorAll('.tab-link').forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.dataset.tab;
                    const container = button.closest('.tabs');
                    container.querySelectorAll('.tab-link').forEach(b => b.classList.remove('active'));
                    button.classList.add('active');
                    container.querySelectorAll('.tab-content').forEach(content => {
                        if (content.id === tabId) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });

            // Accordion functionality
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('span:last-child');
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                        icon.style.transform = 'rotate(0deg)';
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                        icon.style.transform = 'rotate(180deg)';
                    }
                });
            });
            
            // Sidebar active link functionality
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');

            window.addEventListener('scroll', () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - 70) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active');
                    }
                });
            });
        });
    </script>
</body>
</html>
