<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saratoga Interactive Handicapping Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: The application is designed as a single-page dashboard. A sticky top navigation allows users to instantly jump to any of the 9 race analyses or the final "Best Bets" summary. This non-linear structure is superior to a simple document scroll, as users may want to compare specific races or quickly find the day's top plays. Each race is a self-contained card with two interactive tabs: "Analysis" for the detailed breakdown and "Picks & Strategy" for actionable insights. This tabbed approach condenses a large amount of information, preventing cognitive overload and allowing users to choose their desired level of detail. The flow is designed for both deep-dive analysis and quick, at-a-glance decision-making. -->
    <!-- Visualization & Content Choices: The core visualization is a dynamic Chart.js bar chart for each race's "Probability vs. Price" section. Goal: To visually quantify the "value" concept central to the report. Method: A grouped bar chart compares Implied vs. Assessed Probability. Interaction: Hover tooltips provide precise data. Justification: This transforms a key numerical comparison into an immediate, intuitive visual insight, making the concept of an "overlay" or "underlay" instantly understandable. Pace projections are represented by icons for quick recognition. All other content is presented in structured HTML with clear typography to support the user's ability to scan and synthesize information efficiently. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-white shadow-md py-4 px-6 text-center sticky top-0 z-20">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Saratoga Race Course Analysis</h1>
        <p class="text-md text-gray-600">August 20, 2025</p>
    </header>

    <nav class="bg-gray-800 text-white p-2 sticky top-[84px] z-20 overflow-x-auto whitespace-nowrap">
        <div class="container mx-auto flex justify-center items-center">
            <a href="#summary" class="px-3 py-1 font-semibold hover:bg-gray-700 rounded-md">Best Bets</a>
            <span class="px-2">|</span>
            <a href="#race1" class="px-2 py-1 hover:bg-gray-700 rounded-md">R1</a>
            <a href="#race2" class="px-2 py-1 hover:bg-gray-700 rounded-md">R2</a>
            <a href="#race3" class="px-2 py-1 hover:bg-gray-700 rounded-md">R3</a>
            <a href="#race4" class="px-2 py-1 hover:bg-gray-700 rounded-md">R4</a>
            <a href="#race5" class="px-2 py-1 hover:bg-gray-700 rounded-md">R5</a>
            <a href="#race6" class="px-2 py-1 hover:bg-gray-700 rounded-md">R6</a>
            <a href="#race7" class="px-2 py-1 hover:bg-gray-700 rounded-md">R7</a>
            <a href="#race8" class="px-2 py-1 hover:bg-gray-700 rounded-md">R8</a>
            <a href="#race9" class="px-2 py-1 hover:bg-gray-700 rounded-md">R9</a>
        </div>
    </nav>

    <main class="container mx-auto p-4 md:p-6 lg:p-8">
        
        <section id="overview" class="mb-8 bg-white p-6 rounded-lg shadow-lg border border-red-200">
            <h2 class="text-2xl font-bold mb-3 text-red-700">Card-Wide Update</h2>
            <p class="text-lg">
                All races originally scheduled for the turf have been moved to the main track. The main track is officially rated <span class="font-semibold bg-yellow-200 px-2 py-1 rounded">Sloppy</span>. This fundamentally alters the analysis for a majority of the day's races, placing a premium on proven wet-track form and pedigrees suited for an "off" going.
            </p>
        </section>

        <!-- Race sections will be dynamically generated here -->
        <div id="race-sections"></div>

        <section id="summary" class="pt-8">
            <h2 class="text-3xl font-bold mb-4 text-center">Full Card Summary & Strategic Recommendations</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6">
                
                <div class="bg-green-100 border-l-4 border-green-500 text-green-800 p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold mb-2">Prime Bet (A-Grade) ‚≠ê</h3>
                    <p class="font-semibold text-lg">Race 8, #5 Castle Island (30-1 ML)</p>
                    <p>This is a rare situation where the morning line is completely irrelevant due to the surface change. This horse has strong dirt form and figures that make him a prime contender in the now-decimated field. He should offer the best value on the card.</p>
                </div>

                <div class="bg-red-100 border-l-4 border-red-500 text-red-800 p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold mb-2">Key Horizontal 'Single' üéØ</h3>
                    <p class="font-semibold text-lg">Race 4, #4 Barksdale (2-1 ML)</p>
                    <p>Despite the smaller field, he remains a strong single candidate. He drops in class, has a win on a sloppy track, had a major excuse last race, and has a recent bullet workout. He is the most likely winner in a key sequence.</p>
                </div>

                <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-800 p-6 rounded-lg shadow-md md:col-span-2">
                    <h3 class="text-xl font-bold mb-2">Top Value Plays (B-Grade) üí∞</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
                        <div>
                            <p class="font-semibold">Race 3, #9 Mr. J (8-1 ML)</p>
                            <p class="text-sm">Debut severely compromised by a catastrophic start. Pedigree suggests he will relish the sloppy track. A clean break could lead to massive improvement.</p>
                        </div>
                        <div>
                            <p class="font-semibold">Race 4, #2 Jackson Heights (6-1 ML)</p>
                            <p class="text-sm">With the favorite scratched, his proven form on a sloppy track makes him a major contender at a good price.</p>
                        </div>
                        <div>
                            <p class="font-semibold">Race 9, #2 Darty Time (8-1 ML)</p>
                            <p class="text-sm">In a chaotic maiden race moved to a sloppy track, her proven second-place finish in similar conditions makes her a standout value play.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-6 rounded-lg shadow-md md:col-span-2">
                    <h3 class="text-xl font-bold mb-2">Top Fades (Vulnerable Favorites) üëé</h3>
                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                        <div>
                            <p class="font-semibold">Race 1, #1 Givemefive (IRE) (2-1 ML)</p>
                            <p class="text-sm">Faces a perfect storm of negative factors: top weight, a contentious pace duel, and first start at Saratoga. A horse to bet against at a short price.</p>
                        </div>
                        <div>
                            <p class="font-semibold">Race 6, #6 Ticket to Ride (5/2 ML)</p>
                            <p class="text-sm">May take money based on a troubled turf debut, but the switch to a sloppy dirt track is a complete unknown, making her a vulnerable favorite.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

<script>
const raceData = [
    {
        id: 1,
        title: "The Grade 1 Jonathan Sheppard H.",
        distance: "2 3/8 Miles",
        surface: "Turf (Hurdle)",
        class: "Grade 1 Stakes",
        purse: "$150,000",
        pace: { projection: "Pressured Duel", icon: "üêáüí®" },
        thesis: "A \"Pressured Duel\" is projected, orchestrated in part by the connections of #3 Jimmy P to set up his late run. The combination of a strong pace, the demanding 2 3/8-mile distance, and soft turf conditions will favor European-bred horses with proven stamina who can sit off the early speed and make a sustained run.",
        spoiler: "The primary spoiler would be if #1 Givemefive (IRE)'s jockey opts to rate him, allowing #7 The Insider (IRE) to secure an uncontested lead and slow the pace.",
        wagers: "<strong>Primary Wager:</strong> Exacta Box: 3, 5, 6<br><strong>Trifecta:</strong> 3,6 / 3,5,6 / 2,3,5,6,8<br><strong>Multi-Race:</strong> 'A' Horses: 3, 6 | 'B' Horse: 5",
        rankings: [
            { category: "Prime Contenders", horse: "#6 Zarak The Brave (FR)", odds: "4-1" },
            { category: "Prime Contenders", horse: "#3 Jimmy P", odds: "3-1" },
            { category: "Prime Value Overlays", horse: "#5 Who's Counting", odds: "9/2" },
            { category: "Vulnerable Favorites", horse: "#1 Givemefive (IRE)", odds: "2-1" }
        ],
        chartData: {
            labels: ["#5 Who's Counting", "#1 Givemefive (IRE)"],
            implied: [18.2, 33.3],
            assessed: [22, 20],
            verdicts: ["Overlay", "Underlay"]
        }
    },
    {
        id: 2,
        title: "Allowance Optional Claiming",
        distance: "6 Furlongs",
        surface: "Dirt",
        class: "Allowance",
        purse: "$120,000",
        pace: { projection: "Pressured Duel", icon: "üêáüí®" },
        thesis: "A \"Pressured Duel\" between #3 R Disaster and #4 Striker Has Dial is the most probable race shape on a sloppy track. The superior class and proven sloppy track ability of #3 R Disaster should allow her to prevail. However, the duel will likely compromise her margin of victory and set the table for a stalking horse with proven wet track form, #5 Patricia Ann, to complete the exacta at a good price.",
        spoiler: "#4 Striker Has Dial is not sent aggressively from the gate, allowing #3 R Disaster to secure an easy, uncontested lead.",
        wagers: "<strong>Primary Wager:</strong> Exacta: 3 / 5<br><strong>Trifecta:</strong> 3 / 5 / 2,4<br><strong>Multi-Race:</strong> 'A' Horse (Single): 3",
        rankings: [
            { category: "Prime Contenders", horse: "#3 R Disaster", odds: "3/5" },
            { category: "Prime Value Overlays", horse: "#5 Patricia Ann", odds: "5-1" },
            { category: "Vulnerable Favorites", horse: "#3 R Disaster (Win Bet)", odds: "3/5" }
        ],
        chartData: {
            labels: ["#5 Patricia Ann (Place)", "#3 R Disaster (Win)"],
            implied: [16.7, 62.5],
            assessed: [25, 55],
            verdicts: ["Overlay (Exotics)", "Underlay (Win Bet)"]
        }
    },
    {
        id: 3,
        title: "Maiden Optional Claiming",
        distance: "7 Furlongs",
        surface: "Dirt (OFF TURF)",
        class: "Maiden",
        purse: "$80,000",
        pace: { projection: "Moderately Contested", icon: "üêá" },
        thesis: "The race has come off the turf and will be run on a sloppy main track. This gives a significant advantage to horses with proven sloppy track form like #7 Chalky White and those with strong wet-track pedigrees like #9 Mr. J and the Pletcher firsters. The troubled trip of #9 Mr. J in his debut makes him a prime candidate for a major form reversal.",
        spoiler: "The first-time starter #8 Lexington Pike is a monster for the powerful Pletcher/Ortiz Jr. combination and simply runs away from this field on debut.",
        wagers: "<strong>Primary Wager:</strong> Win/Place/Show bet on #9 Mr. J.<br><strong>Exacta Box:</strong> 7, 8, 9<br><strong>Multi-Race:</strong> 'A' Horses: 7, 8, 9 | 'B' Horse: 3",
        rankings: [
            { category: "Prime Contenders", horse: "#7 Chalky White", odds: "3-1" },
            { category: "Prime Contenders", horse: "#8 Lexington Pike", odds: "5/2" },
            { category: "Prime Value Overlays", horse: "#9 Mr. J", odds: "8-1" },
            { category: "Vulnerable Favorites", horse: "#7 Chalky White", odds: "3-1" }
        ],
        chartData: {
            labels: ["#9 Mr. J", "#7 Chalky White"],
            implied: [11.1, 25.0],
            assessed: [20, 22],
            verdicts: ["Overlay", "Underlay"]
        }
    },
    {
        id: 4,
        title: "Starter Optional Claiming",
        distance: "6 Furlongs",
        surface: "Dirt",
        class: "Starter",
        purse: "$63,000",
        pace: { projection: "Moderately Contested", icon: "üêá" },
        thesis: "With the favorite scratched and on a sloppy track, the race is wide open. The class-dropping #4 Barksdale holds a significant advantage due to his proven ability on a wet surface, his troubled trip last out, and sharp recent workout. He is the horse to beat.",
        spoiler: "The pace is slower than anticipated, allowing a horse like #3 Stewie or #6 Amundson to get an easy lead and steal the race on the front end.",
        wagers: "<strong>Primary Wager:</strong> Win bet on #4 Barksdale.<br><strong>Exacta Box:</strong> 2, 4<br><strong>Multi-Race:</strong> 'A' Horse (Single): 4",
        rankings: [
            { category: "Prime Contenders", horse: "#4 Barksdale", odds: "2-1" },
            { category: "Prime Value Overlays", horse: "#2 Jackson Heights", odds: "6-1" },
        ],
        chartData: {
            labels: ["#2 Jackson Heights", "#4 Barksdale"],
            implied: [14.3, 33.3],
            assessed: [20, 45],
            verdicts: ["Overlay", "Overlay"]
        }
    },
    {
        id: 5,
        title: "Maiden Special Weight",
        distance: "1 Mile",
        surface: "Dirt (OFF TURF)",
        class: "Maiden",
        purse: "$90,000",
        pace: { projection: "Pace Void (Slow)", icon: "üê¢" },
        thesis: "A \"Pace Void\" on a sloppy track creates a tactical race where jockey intent and wet-track pedigree are paramount. The combination of a top wet-track pedigree and aggressive jockey Irad Ortiz Jr. makes #2 Askingforafriend a prime value play.",
        spoiler: "#6 Oat Coutour, who has some dirt experience, gets an uncontested lead and wires the field at a price.",
        wagers: "<strong>Primary Wager:</strong> Win bet on #2 Askingforafriend.<br><strong>Exacta Box:</strong> 2, 3, 8<br><strong>Multi-Race:</strong> 'A' Horses: 2, 3, 8 | 'B' Horse: 6",
        rankings: [
            { category: "Prime Contenders", horse: "#3 Spirit of the Law", odds: "3-1" },
            { category: "Prime Contenders", horse: "#8 Willpowered", odds: "4-1" },
            { category: "Prime Value Overlays", horse: "#2 Askingforafriend", odds: "7/2" },
        ],
        chartData: {
            labels: ["#2 Askingforafriend", "#3 Spirit of the Law"],
            implied: [22.2, 25.0],
            assessed: [30, 25],
            verdicts: ["Overlay", "Fair Value"]
        }
    },
    {
        id: 6,
        title: "Maiden Special Weight",
        distance: "5 1/2 Furlongs",
        surface: "Dirt (OFF TURF)",
        class: "Maiden",
        purse: "$90,000",
        pace: { projection: "Moderately Contested", icon: "üêá" },
        thesis: "In a race moved to a sloppy dirt track, the well-bred and well-prepared first-time starter #12 Hot Currency from the high-percentage Rice/Ortiz Jr. combination is the horse to beat. Her pedigree is suitable for the conditions, and she is trained for a top debut effort.",
        spoiler: "#2 Cara's Dreamchaser uses her experience on a sloppy track to her advantage and pulls off the upset.",
        wagers: "<strong>Primary Wager:</strong> Win bet on #12 Hot Currency.<br><strong>Exacta Box:</strong> 2, 7, 12<br><strong>Multi-Race:</strong> 'A' Horse: 12 | 'B' Horses: 2, 7",
        rankings: [
            { category: "Prime Contenders", horse: "#12 Hot Currency", odds: "7/2" },
            { category: "Prime Contenders", horse: "#7 Midtown Mischief", odds: "5-1" },
            { category: "Prime Value Overlays", horse: "#2 Cara's Dreamchaser", odds: "12-1" },
            { category: "Vulnerable Favorites", horse: "#6 Ticket to Ride", odds: "5/2" },
        ],
        chartData: {
            labels: ["#2 Cara's Dreamchaser", "#12 Hot Currency"],
            implied: [7.7, 22.2],
            assessed: [15, 30],
            verdicts: ["Overlay", "Overlay"]
        }
    },
    {
        id: 7,
        title: "Claiming",
        distance: "1 Mile",
        surface: "Dirt",
        class: "Claiming",
        purse: "$60,000",
        pace: { projection: "Pace Void (Slow)", icon: "üê¢" },
        thesis: "A \"Pace Void\" on a sloppy track makes this a tactical affair. #2 Passing Game is the class of the field and is in the best current form. His tactical speed and proven ability on an off-track should allow him to work out a perfect trip. He is the most likely winner.",
        spoiler: "#5 Notah with Irad Ortiz Jr. aboard gets an uncontested lead and wires the field.",
        wagers: "<strong>Primary Wager:</strong> Exacta Box: 2, 5<br><strong>Trifecta:</strong> 2,5 / 2,5 / 1,4,6<br><strong>Multi-Race:</strong> 'A' Horse: 2 | 'B' Horse: 5",
        rankings: [
            { category: "Prime Contenders", horse: "#2 Passing Game", odds: "5/2" },
            { category: "Prime Value Overlays", horse: "#5 Notah", odds: "4-1" },
        ],
        chartData: {
            labels: ["#5 Notah", "#2 Passing Game"],
            implied: [20.0, 28.6],
            assessed: [25, 45],
            verdicts: ["Overlay", "Overlay"]
        }
    },
    {
        id: 8,
        title: "Claiming",
        distance: "1 Mile",
        surface: "Dirt (OFF TURF)",
        class: "Claiming",
        purse: "$68,000",
        pace: { projection: "Moderately Contested", icon: "üêá" },
        thesis: "In a small field on a sloppy track, early speed and proven wet-track form are key. #1A Loco Abarrio is the speed of the race, but the consistent #5 Castle Island and the sloppy track specialist #13 He's Got This are major threats.",
        spoiler: "#1A Loco Abarrio gets an easy lead and wires the field.",
        wagers: "<strong>Primary Wager:</strong> Win/Place/Show bet on #5 Castle Island.<br><strong>Exacta Box:</strong> 1A, 5, 13<br><strong>Multi-Race:</strong> 'A' Horses: 5, 13 | 'B' Horse: 1A",
        rankings: [
            { category: "Prime Contenders", horse: "#5 Castle Island", odds: "30-1" },
            { category: "Prime Contenders", horse: "#1A Loco Abarrio", odds: "6-1" },
            { category: "Prime Value Overlays", horse: "#13 He's Got This", odds: "6-1" },
        ],
        chartData: {
            labels: ["#13 He's Got This", "#5 Castle Island"],
            implied: [14.3, 3.2],
            assessed: [25, 35],
            verdicts: ["Overlay", "Massive Overlay"]
        }
    },
    {
        id: 9,
        title: "Maiden Claiming",
        distance: "5 1/2 Furlongs",
        surface: "Dirt (OFF TURF)",
        class: "Maiden",
        purse: "$55,000",
        pace: { projection: "Moderately Contested", icon: "üêá" },
        thesis: "The class drop and strong dirt figures make #13 Miss Im Pulsive the horse to beat. Her pedigree suggests she will handle the sloppy track. #2 Darty Time is a major threat due to her proven form on a wet surface.",
        spoiler: "#14 Laughing Lady takes to the sloppy track and uses her class drop to her advantage, wiring the field.",
        wagers: "<strong>Primary Wager:</strong> Win bet on #2 Darty Time.<br><strong>Exacta Box:</strong> 2, 13, 14<br><strong>Multi-Race:</strong> 'A' Horses: 2, 13, 14 | 'B' Horse: 3",
        rankings: [
            { category: "Prime Contenders", horse: "#13 Miss Im Pulsive", odds: "6-1" },
            { category: "Prime Contenders", horse: "#2 Darty Time", odds: "8-1" },
            { category: "Prime Value Overlays", horse: "#14 Laughing Lady", odds: "3-1" },
        ],
        chartData: {
            labels: ["#2 Darty Time", "#14 Laughing Lady"],
            implied: [11.1, 25.0],
            assessed: [25, 30],
            verdicts: ["Overlay", "Overlay"]
        }
    }
];

function createRaceSection(race) {
    const section = document.createElement('section');
    section.id = `race${race.id}`;
    section.className = 'pt-8 mb-8';

    section.innerHTML = `
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <div class="border-b-2 border-gray-200 pb-4 mb-4">
                <h2 class="text-3xl font-bold">Race ${race.id}: ${race.title}</h2>
                <div class="flex flex-wrap text-gray-600 mt-2 text-sm md:text-base">
                    <span class="mr-4"><strong>Distance:</strong> ${race.distance}</span>
                    <span class="mr-4"><strong>Surface:</strong> ${race.surface}</span>
                    <span class="mr-4"><strong>Class:</strong> ${race.class}</span>
                    <span><strong>Purse:</strong> ${race.purse}</span>
                </div>
            </div>

            <div>
                <div class="mb-4 border-b border-gray-200">
                    <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="tabs-${race.id}" role="tablist">
                        <li class="mr-2" role="presentation">
                            <button class="inline-block p-4 border-b-2 rounded-t-lg" id="analysis-tab-${race.id}" type="button" role="tab" aria-controls="analysis-${race.id}" aria-selected="true">Analysis</button>
                        </li>
                        <li class="mr-2" role="presentation">
                            <button class="inline-block p-4 border-b-2 rounded-t-lg hover:text-gray-600 hover:border-gray-300" id="picks-tab-${race.id}" type="button" role="tab" aria-controls="picks-${race.id}" aria-selected="false">Picks & Strategy</button>
                        </li>
                    </ul>
                </div>
                <div id="tab-content-${race.id}">
                    <div class="p-4 rounded-lg bg-gray-50" id="analysis-${race.id}" role="tabpanel" aria-labelledby="analysis-tab-${race.id}">
                        <h3 class="text-xl font-semibold mb-3">Pace Projection: <span class="text-blue-600">${race.pace.projection} ${race.pace.icon}</span></h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-lg mb-2">Race Thesis</h4>
                                <p>${race.thesis}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-lg mb-2">Spoiler Scenario</h4>
                                <p>${race.spoiler}</p>
                            </div>
                        </div>
                    </div>
                    <div class="hidden p-4 rounded-lg bg-gray-50" id="picks-${race.id}" role="tabpanel" aria-labelledby="picks-tab-${race.id}">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-lg mb-2">Value-Oriented Rankings</h4>
                                <div id="rankings-table-${race.id}" class="space-y-2"></div>
                                <h4 class="font-semibold text-lg mt-4 mb-2">Wager Construction</h4>
                                <div class="text-sm p-3 bg-gray-100 rounded-md">${race.wagers}</div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-lg mb-2 text-center">Probability vs. Price</h4>
                                <div class="chart-container">
                                    <canvas id="chart-${race.id}"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    const raceSectionsContainer = document.getElementById('race-sections');
    raceSectionsContainer.appendChild(section);

    const rankingsTable = document.getElementById(`rankings-table-${race.id}`);
    race.rankings.forEach(r => {
        const div = document.createElement('div');
        div.className = 'flex justify-between items-center p-2 rounded-md';
        let bgColor = 'bg-gray-100';
        if (r.category.includes('Value')) bgColor = 'bg-green-100';
        if (r.category.includes('Vulnerable')) bgColor = 'bg-red-100';
        div.classList.add(bgColor);
        div.innerHTML = `
            <div>
                <p class="font-semibold">${r.horse}</p>
                <p class="text-xs text-gray-600">${r.category}</p>
            </div>
            <p class="font-bold text-lg">${r.odds}</p>
        `;
        rankingsTable.appendChild(div);
    });

    setupTabs(race.id);
    createChart(race.id, race.chartData);
}

function setupTabs(raceId) {
    const analysisTab = document.getElementById(`analysis-tab-${raceId}`);
    const picksTab = document.getElementById(`picks-tab-${raceId}`);
    const analysisContent = document.getElementById(`analysis-${raceId}`);
    const picksContent = document.getElementById(`picks-${raceId}`);

    const activeClasses = ['border-blue-600', 'text-blue-600'];
    const inactiveClasses = ['border-transparent', 'hover:text-gray-600', 'hover:border-gray-300'];

    analysisTab.classList.add(...activeClasses);

    analysisTab.addEventListener('click', () => {
        analysisContent.classList.remove('hidden');
        picksContent.classList.add('hidden');
        analysisTab.classList.add(...activeClasses);
        analysisTab.classList.remove(...inactiveClasses);
        picksTab.classList.remove(...activeClasses);
        picksTab.classList.add(...inactiveClasses);
    });

    picksTab.addEventListener('click', () => {
        picksContent.classList.remove('hidden');
        analysisContent.classList.add('hidden');
        picksTab.classList.add(...activeClasses);
        picksTab.classList.remove(...inactiveClasses);
        analysisTab.classList.remove(...activeClasses);
        analysisTab.classList.add(...inactiveClasses);
    });
}

function createChart(raceId, data) {
    const ctx = document.getElementById(`chart-${raceId}`).getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels.map(label => label.length > 16 ? label.substring(0, 16) + '...' : label),
            datasets: [
                {
                    label: 'Implied Probability (%)',
                    data: data.implied,
                    backgroundColor: 'rgba(255, 99, 132, 0.5)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Assessed Probability (%)',
                    data: data.assessed,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Probability (%)'
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        footer: function(tooltipItems) {
                            const index = tooltipItems[0].dataIndex;
                            return 'Verdict: ' + data.verdicts[index];
                        }
                    }
                },
                legend: {
                    position: 'top',
                },
            }
        }
    });
}

document.addEventListener('DOMContentLoaded', () => {
    raceData.forEach(createRaceSection);
});

</script>
</body>
</html>
